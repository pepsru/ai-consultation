<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è | –ù–µ–π—Ä–æ–≥—Ä–∞—Ñ–∏–∫–∞</title>
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #3b82f6;
            --secondary-color: #60a5fa;
            --accent-color: #2563eb;
            --bg-dark: #0a0a0f;
            --bg-card: #1a1a2e;
            --text-primary: #ffffff;
            --text-secondary: #b0b0c0;
            --border-glow: rgba(0, 245, 255, 0.3);
        }

        @keyframes backgroundShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px var(--border-glow); }
            50% { box-shadow: 0 0 40px var(--primary-color); }
        }

        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(124, 58, 237, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 245, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 0, 255, 0.1) 0%, transparent 50%);
            background-size: 100% 100%;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Neural network background - DISABLED for performance */
        .neural-bg {
            display: none;
        }

        .neural-node {
            display: none;
        }

        .container {
            background: rgba(26, 26, 46, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            border: 1px solid rgba(0, 245, 255, 0.2);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.5),
                inset 0 0 60px rgba(0, 245, 255, 0.05);
            max-width: 600px;
            width: 100%;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }

        .header {
            background: linear-gradient(135deg, 
                rgba(124, 58, 237, 0.3) 0%, 
                rgba(0, 245, 255, 0.2) 100%);
            padding: 50px 40px;
            text-align: center;
            position: relative;
        }

        .ai-icon {
            font-size: 64px;
            margin-bottom: 20px;
            position: relative;
            display: inline-block;
            filter: drop-shadow(0 0 20px var(--primary-color));
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 12px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
        }

        .header p {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.6;
            position: relative;
        }

        .form-container {
            padding: 40px;
        }

        .benefits {
            background: linear-gradient(135deg, 
                rgba(124, 58, 237, 0.1) 0%, 
                rgba(0, 245, 255, 0.05) 100%);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 245, 255, 0.2);
            position: relative;
        }

        .benefits h3 {
            color: var(--primary-color);
            margin-bottom: 18px;
            font-size: 18px;
            font-weight: 600;
            position: relative;
        }

        .benefits ul {
            list-style: none;
            padding: 0;
            position: relative;
        }

        .benefits li {
            padding: 10px 0;
            color: var(--text-secondary);
            position: relative;
            padding-left: 30px;
        }

        .benefits li::before {
            content: "‚óÜ";
            position: absolute;
            left: 0;
            color: var(--primary-color);
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 10px;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input, select, textarea {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 15px;
            font-size: 16px;
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 
                0 0 20px rgba(0, 245, 255, 0.2),
                inset 0 0 20px rgba(0, 245, 255, 0.05);
        }

        input::placeholder, textarea::placeholder {
            color: var(--text-secondary);
            opacity: 0.6;
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2300f5ff'%3E%3Cpath d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 20px center;
            padding-right: 45px;
        }

        select option {
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 10px;
        }

        .datetime-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
            color: var(--text-primary);
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            transition: left 0.5s ease;
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 15px 35px rgba(124, 58, 237, 0.4),
                0 0 30px var(--primary-color);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .message {
            padding: 18px;
            border-radius: 15px;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 500;
            display: none;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .success-message {
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.2), 
                rgba(5, 150, 105, 0.2));
            border: 1px solid rgba(16, 185, 129, 0.5);
            color: #10b981;
        }

        .error-message {
            background: linear-gradient(135deg, 
                rgba(239, 68, 68, 0.2), 
                rgba(220, 38, 38, 0.2));
            border: 1px solid rgba(239, 68, 68, 0.5);
            color: #ef4444;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
            margin-left: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .info-text {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 8px;
            font-style: italic;
        }

        .time-slot {
            display: inline-block;
            padding: 8px 16px;
            background: rgba(0, 245, 255, 0.1);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 10px;
            margin: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .time-slot:hover {
            background: rgba(0, 245, 255, 0.2);
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        .time-slot.selected {
            background: var(--primary-color);
            color: var(--bg-dark);
            border-color: var(--primary-color);
        }

        .time-slots-container {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        @media (max-width: 600px) {
            .container {
                border-radius: 20px;
            }
            
            .header {
                padding: 40px 25px;
            }
            
            .header h1 {
                font-size: 26px;
            }
            
            .form-container {
                padding: 30px 25px;
            }

            .datetime-group {
                grid-template-columns: 1fr;
            }

            .ai-icon {
                font-size: 48px;
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }
    </style>
</head>
<body>
    <!-- Neural network background -->
    <div class="neural-bg" id="neuralBg"></div>

    <div class="container">
        <div class="header">
            <div class="ai-icon">üß†</div>
            <h1>AI –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</h1>
            <p>–û—Ç–∫—Ä–æ–π—Ç–µ –º–∏—Ä –±–µ–∑–≥—Ä–∞–Ω–∏—á–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –Ω–µ–π—Ä–æ–≥—Ä–∞—Ñ–∏–∫–∏</p>
        </div>
        
        <div class="form-container">
            <div class="benefits">
                <h3>‚óÜ –ß—Ç–æ –≤–∞—Å –∂–¥—ë—Ç</h3>
                <ul>
                    <li>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–±–æ—Ç—ã —Å AI</li>
                    <li>–ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ –ø—Ä–æ–º–ø—Ç-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–∞</li>
                    <li>–°–µ–∫—Ä–µ—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫–∏</li>
                    <li>–ü—Ä–∞–∫—Ç–∏–∫–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö</li>
                    <li>–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è –≤–∞—à–∏—Ö –Ω–∞–≤—ã–∫–æ–≤</li>
                </ul>
            </div>

            <div class="success-message message" id="successMessage">
                ‚úì –ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!
            </div>

            <div class="error-message message" id="errorMessage">
                ‚ö† –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π.
            </div>

            <form id="consultationForm">
                <div class="form-group">
                    <label for="fullName">‚óÜ –§–ò–û</label>
                    <input 
                        type="text" 
                        id="fullName" 
                        name="fullName" 
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –∏–º—è"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="phone">‚óÜ –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                    <input 
                        type="tel" 
                        id="phone" 
                        name="phone" 
                        placeholder="+7 (999) 123-45-67"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="telegram">‚óÜ Telegram</label>
                    <input 
                        type="text" 
                        id="telegram" 
                        name="telegram" 
                        placeholder="@username"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="consultationType">‚óÜ –¢–∏–ø –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</label>
                    <select id="consultationType" name="consultationType" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</option>
                        <option value="basic">–ë–∞–∑–æ–≤–∞—è (1 —á–∞—Å) - –æ—Ç 3000‚ÇΩ</option>
                        <option value="advanced">–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è (2 —á–∞—Å–∞) - –æ—Ç 5000‚ÇΩ</option>
                        <option value="intensive">–ò–Ω—Ç–µ–Ω—Å–∏–≤ (4 —á–∞—Å–∞) - –æ—Ç 9000‚ÇΩ</option>
                        <option value="package">–ü–∞–∫–µ—Ç (5 –∑–∞–Ω—è—Ç–∏–π) - –æ—Ç 20000‚ÇΩ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="consultationDate">‚óÜ –ñ–µ–ª–∞–µ–º–∞—è –¥–∞—Ç–∞</label>
                    <input 
                        type="date" 
                        id="consultationDate" 
                        name="consultationDate"
                        required
                    >
                    <p class="info-text">–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—É—é –¥–∞—Ç—É –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</p>
                </div>

                <div class="form-group">
                    <label>‚óÜ –ñ–µ–ª–∞–µ–º–æ–µ –≤—Ä–µ–º—è</label>
                    <div class="time-slots-container" id="timeSlotsContainer">
                        <div class="time-slot" data-time="10:00">10:00</div>
                        <div class="time-slot" data-time="12:00">12:00</div>
                        <div class="time-slot" data-time="14:00">14:00</div>
                        <div class="time-slot" data-time="16:00">16:00</div>
                        <div class="time-slot" data-time="18:00">18:00</div>
                        <div class="time-slot" data-time="20:00">20:00</div>
                    </div>
                    <input type="hidden" id="selectedTime" name="selectedTime" required>
                    <p class="info-text">–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è</p>
                </div>

                <div class="form-group">
                    <label for="comments">‚óÜ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                    <textarea 
                        id="comments" 
                        name="comments" 
                        rows="3"
                        placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–≤–æ–∏—Ö —Ü–µ–ª—è—Ö –∏ –æ–∂–∏–¥–∞–Ω–∏—è—Ö –æ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏..."
                    ></textarea>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">
                    <span id="btnText">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</span>
                </button>
            </form>
        </div>
    </div>

    <script>
        // ============================================
        // TELEGRAM WEB APP INTEGRATION
        // ============================================
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = window.Telegram?.WebApp;
        let isTelegramApp = false;
        
        if (tg && tg.initData) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ Telegram, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –±—Ä–∞—É–∑–µ—Ä
            isTelegramApp = true;
            
            try {
                tg.ready(); // –°–æ–æ–±—â–∞–µ–º —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
                tg.expand(); // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
            } catch (e) {
                console.log('Telegram API –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:', e.message);
            }
            
            console.log('‚úÖ –§–æ—Ä–º–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –≤ Telegram Mini App');
            console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', tg.initDataUnsafe?.user);
        } else {
            console.log('üåê –§–æ—Ä–º–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ');
        }

        // Neural network background - DISABLED for performance
        // function createNeuralNetwork() - removed for better performance

        // Form elements
        const form = document.getElementById('consultationForm');
        const submitBtn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        const phoneInput = document.getElementById('phone');
        const telegramInput = document.getElementById('telegram');
        const dateInput = document.getElementById('consultationDate');
        const timeSlots = document.querySelectorAll('.time-slot');
        const selectedTimeInput = document.getElementById('selectedTime');
        
        // ============================================
        // –ê–í–¢–û–ó–ê–ü–û–õ–ù–ï–ù–ò–ï –ò–ó TELEGRAM
        // ============================================
        
        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
        setTimeout(() => {
            if (isTelegramApp && tg.initDataUnsafe?.user) {
                const user = tg.initDataUnsafe.user;
                
                console.log('–ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è:', user);
                
                // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ Telegram username
                if (user.username) {
                    telegramInput.value = '@' + user.username;
                    console.log('‚úÖ Username –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω:', '@' + user.username);
                } else {
                    console.log('‚ö†Ô∏è –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç username –≤ Telegram');
                }
                
                // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏
                if (user.first_name) {
                    const fullName = user.first_name + (user.last_name ? ' ' + user.last_name : '');
                    const nameInput = document.getElementById('fullName');
                    if (!nameInput.value) { // –ù–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –µ—Å–ª–∏ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
                        nameInput.value = fullName;
                        console.log('‚úÖ –ò–º—è –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ:', fullName);
                    }
                }
            }
        }, 300);

        // Set minimum date to today
        const today = new Date().toISOString().split('T')[0];
        dateInput.setAttribute('min', today);

        // Phone formatting
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            
            if (value.length > 0) {
                if (value[0] === '7' || value[0] === '8') {
                    value = '7' + value.substring(1);
                } else if (value[0] !== '7') {
                    value = '7' + value;
                }
                
                let formatted = '+7';
                if (value.length > 1) {
                    formatted += ' (' + value.substring(1, 4);
                }
                if (value.length >= 5) {
                    formatted += ') ' + value.substring(4, 7);
                }
                if (value.length >= 8) {
                    formatted += '-' + value.substring(7, 9);
                }
                if (value.length >= 10) {
                    formatted += '-' + value.substring(9, 11);
                }
                
                e.target.value = formatted;
            }
        });

        // Telegram username validation
        telegramInput.addEventListener('input', function(e) {
            let value = e.target.value;
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º @ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
            if (value && !value.startsWith('@')) {
                value = '@' + value;
            }
            
            // –£–±–∏—Ä–∞–µ–º @ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–º–≤–æ–ª—ã
            let username = value.substring(1);
            
            // Telegram username –ø—Ä–∞–≤–∏–ª–∞:
            // - –¢–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—è
            // - –ú–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤
            // - –ù–µ –º–æ–∂–µ—Ç –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å —Ü–∏—Ñ—Ä—ã
            username = username.replace(/[^a-zA-Z0-9_]/g, '');
            
            // –ï—Å–ª–∏ –ø–µ—Ä–≤—ã–π —Å–∏–º–≤–æ–ª - —Ü–∏—Ñ—Ä–∞, —É–±–∏—Ä–∞–µ–º –µ—ë
            if (username.length > 0 && /^\d/.test(username)) {
                username = username.substring(1);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
            e.target.value = username ? '@' + username : '';
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏
            if (username.length >= 5) {
                e.target.style.borderColor = 'var(--primary-color)';
            } else if (username.length > 0) {
                e.target.style.borderColor = '#fbbf24'; // –ñ—ë–ª—Ç—ã–π - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
            } else {
                e.target.style.borderColor = 'rgba(0, 245, 255, 0.2)';
            }
        });

        // Time slot selection
        timeSlots.forEach(slot => {
            slot.addEventListener('click', function() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ —Å–ª–æ—Ç
                if (this.classList.contains('disabled')) {
                    return; // –ù–µ –¥–∞—ë–º –≤—ã–±—Ä–∞—Ç—å –∑–∞–Ω—è—Ç—ã–π —Å–ª–æ—Ç
                }
                
                timeSlots.forEach(s => s.classList.remove('selected'));
                this.classList.add('selected');
                selectedTimeInput.value = this.getAttribute('data-time');
            });
        });

        // –ü–†–û–í–ï–†–ö–ê –î–û–°–¢–£–ü–ù–û–°–¢–ò –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –¥–∞—Ç—ã
        dateInput.addEventListener('change', async function() {
            const selectedDate = this.value;
            
            if (!selectedDate) return;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            const timeSlotsContainer = document.getElementById('timeSlotsContainer');
            timeSlotsContainer.style.opacity = '0.5';
            timeSlotsContainer.style.pointerEvents = 'none';
            
            try {
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã
                const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyF9bbu2p7XHkbsbeHWouJq5N07PQztBKSSdfkBSWsCGKfmVe_YRoqDiR3dv4OFSNGN/exec';
                const response = await fetch(
                    `${GOOGLE_SCRIPT_URL}?action=checkAvailability&date=${selectedDate}`
                );
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–ª–æ—Ç–æ–≤
                    timeSlots.forEach(slot => {
                        const time = slot.getAttribute('data-time');
                        
                        if (data.availableSlots.includes(time)) {
                            // –°–ª–æ—Ç —Å–≤–æ–±–æ–¥–µ–Ω
                            slot.classList.remove('disabled');
                            slot.style.opacity = '1';
                            slot.style.cursor = 'pointer';
                            slot.style.pointerEvents = 'auto';
                        } else {
                            // –°–ª–æ—Ç –∑–∞–Ω—è—Ç
                            slot.classList.add('disabled');
                            slot.classList.remove('selected');
                            slot.style.opacity = '0.3';
                            slot.style.cursor = 'not-allowed';
                            slot.style.pointerEvents = 'none';
                            
                            // –ï—Å–ª–∏ —ç—Ç–æ—Ç —Å–ª–æ—Ç –±—ã–ª –≤—ã–±—Ä–∞–Ω - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
                            if (selectedTimeInput.value === time) {
                                selectedTimeInput.value = '';
                            }
                        }
                    });
                    
                    console.log('‚úÖ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã:', data.availableSlots);
                    console.log('‚ùå –ó–∞–Ω—è—Ç—ã–µ —Å–ª–æ—Ç—ã:', data.bookedSlots);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏:', error);
                // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ - –¥–µ–ª–∞–µ–º –≤—Å–µ —Å–ª–æ—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏
                timeSlots.forEach(slot => {
                    slot.classList.remove('disabled');
                    slot.style.opacity = '1';
                    slot.style.cursor = 'pointer';
                    slot.style.pointerEvents = 'auto';
                });
            } finally {
                // –£–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                timeSlotsContainer.style.opacity = '1';
                timeSlotsContainer.style.pointerEvents = 'auto';
            }
        });

        // Form submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Hide previous messages
            successMessage.style.display = 'none';
            errorMessage.style.display = 'none';
            
            // Validate time selection
            if (!selectedTimeInput.value) {
                errorMessage.textContent = '‚ö† –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏';
                errorMessage.style.display = 'block';
                return;
            }
            
            // Get form data
            const formData = {
                fullName: document.getElementById('fullName').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                telegram: document.getElementById('telegram').value.trim(),
                consultationType: document.getElementById('consultationType').value,
                consultationDate: document.getElementById('consultationDate').value,
                consultationTime: selectedTimeInput.value,
                comments: document.getElementById('comments').value.trim(),
                timestamp: new Date().toISOString()
            };
            
            // Validate
            if (!formData.fullName || !formData.phone || !formData.telegram || 
                !formData.consultationType || !formData.consultationDate) {
                errorMessage.textContent = '‚ö† –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è';
                errorMessage.style.display = 'block';
                return;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram username
            const telegramUsername = formData.telegram.substring(1); // –£–±–∏—Ä–∞–µ–º @
            if (!formData.telegram.startsWith('@') || telegramUsername.length < 5) {
                errorMessage.textContent = '‚ö† Telegram –Ω–∏–∫ –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å @ –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤';
                errorMessage.style.display = 'block';
                return;
            }
            
            if (!/^[a-zA-Z0-9_]+$/.test(telegramUsername)) {
                errorMessage.textContent = '‚ö† Telegram –Ω–∏–∫ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _';
                errorMessage.style.display = 'block';
                return;
            }
            
            // Disable button and show loading
            submitBtn.disabled = true;
            btnText.innerHTML = '–û—Ç–ø—Ä–∞–≤–∫–∞ <span class="loading"></span>';
            
            try {
                // Send to Google Sheets
                await sendToGoogleSheets(formData);
                
                // Create Google Calendar event
                await createGoogleCalendarEvent(formData);
                
                // Send to Telegram (optional)
                sendToTelegram(formData);
                
                // Show success
                successMessage.style.display = 'block';
                form.reset();
                timeSlots.forEach(s => s.classList.remove('selected'));
                selectedTimeInput.value = '';
                
                // Scroll to success message
                successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // –ï—Å–ª–∏ –≤ Telegram - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                if (isTelegramApp && tg) {
                    console.log('‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ Telegram Mini App');
                }
                
            } catch (error) {
                console.error('Error:', error);
                errorMessage.textContent = '‚ö† –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å –Ω–∞–ø—Ä—è–º—É—é.';
                errorMessage.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                btnText.textContent = '–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é';
            }
        });

        // Google Sheets Integration
        async function sendToGoogleSheets(data) {
            // –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à Google Apps Script Web App URL
            const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyF9bbu2p7XHkbsbeHWouJq5N07PQztBKSSdfkBSWsCGKfmVe_YRoqDiR3dv4OFSNGN/exec';
            
            const payload = {
                fullName: data.fullName,
                phone: data.phone,
                telegram: data.telegram,
                consultationType: data.consultationType,
                consultationDate: data.consultationDate,
                consultationTime: data.consultationTime,
                comments: data.comments,
                timestamp: data.timestamp
            };
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets
            const response = await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            });
            
            console.log('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Google Sheets:', payload);
            return Promise.resolve();
        }

        // Google Calendar Integration
        async function createGoogleCalendarEvent(data) {
            // –≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç OAuth 2.0 –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            // –î–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Google Calendar API
            
            const eventDetails = {
                summary: `AI –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è - ${data.fullName}`,
                description: `
–ö–ª–∏–µ–Ω—Ç: ${data.fullName}
–¢–µ–ª–µ—Ñ–æ–Ω: ${data.phone}
Telegram: ${data.telegram}
–¢–∏–ø: ${data.consultationType}
–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: ${data.comments}
                `.trim(),
                start: {
                    dateTime: `${data.consultationDate}T${data.consultationTime}:00`,
                    timeZone: 'Europe/Moscow'
                },
                end: {
                    dateTime: `${data.consultationDate}T${parseInt(data.consultationTime.split(':')[0]) + 1}:00:00`,
                    timeZone: 'Europe/Moscow'
                }
            };
            
            console.log('–°–æ–±—ã—Ç–∏–µ –¥–ª—è Google Calendar:', eventDetails);
            
            // –î–ª—è —É–ø—Ä–æ—â—ë–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ - —Å–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å
            const calendarUrl = createGoogleCalendarLink(data);
            console.log('–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—å:', calendarUrl);
            
            return Promise.resolve();
        }

        // Create Google Calendar link
        function createGoogleCalendarLink(data) {
            const startDate = data.consultationDate.replace(/-/g, '');
            const startTime = data.consultationTime.replace(':', '') + '00';
            const endTime = (parseInt(data.consultationTime.split(':')[0]) + 1).toString().padStart(2, '0') + '0000';
            
            const params = new URLSearchParams({
                action: 'TEMPLATE',
                text: `AI –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è - ${data.fullName}`,
                dates: `${startDate}T${startTime}/${startDate}T${endTime}`,
                details: `–ö–ª–∏–µ–Ω—Ç: ${data.fullName}\n–¢–µ–ª–µ—Ñ–æ–Ω: ${data.phone}\nTelegram: ${data.telegram}\n–¢–∏–ø: ${data.consultationType}`,
                location: 'Online'
            });
            
            return `https://calendar.google.com/calendar/render?${params.toString()}`;
        }

        // Telegram Integration
        function sendToTelegram(data) {
            const TELEGRAM_BOT_TOKEN = '8596783518:AAH7C8jheZC_95gFvZGDvLp6eH_v4hvYryE';
            const TELEGRAM_CHAT_ID = '7823521532';
            
            const message = `
üß† <b>–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é!</b>

üë§ <b>–§–ò–û:</b> ${data.fullName}
üì± <b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> ${data.phone}
üí¨ <b>Telegram:</b> ${data.telegram}

üìã <b>–¢–∏–ø:</b> ${data.consultationType}
üìÖ <b>–î–∞—Ç–∞:</b> ${data.consultationDate}
‚è∞ <b>–í—Ä–µ–º—è:</b> ${data.consultationTime}

üí≠ <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</b>
${data.comments || '–ù–µ —É–∫–∞–∑–∞–Ω'}

üïê <b>–ü–æ–ª—É—á–µ–Ω–æ:</b> ${new Date(data.timestamp).toLocaleString('ru-RU')}
            `.trim();
            
            // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
            
            fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    chat_id: TELEGRAM_CHAT_ID,
                    text: message,
                    parse_mode: 'HTML'
                })
            })
            .then(response => response.json())
            .then(data => console.log('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram:', data))
            .catch(error => console.error('–û—à–∏–±–∫–∞ Telegram:', error));
            
            
            console.log('–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è Telegram:', message);
        }
    </script>
</body>
</html>
